<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text Watermarking Tool for phpBB</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 20px;
        }

        textarea {
            width: 100%;
            height: 150px;
            margin-bottom: 10px;
        }

        .preview {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
        }

        .invisible-space-char {
            color: #f9f9f9;
        }

        .invisible-paragraph-container {
            display: block;
            line-height: 0.1px;
            height: 0.1px;
            overflow: hidden;
        }

        .invisible-fragment {
            font-size: 1px;
        }
    </style>
</head>
<body>
    <h1>Text Watermarking Tool for phpBB</h1>
    <label for="bbcodeInput">Original Text (with BBCode):</label>
    <textarea id="bbcodeInput" placeholder="Paste your BBCode content here..."></textarea>

    <label for="watermarkPhrases">Custom Invisible Paragraph/Sentence Phrases (one per line):</label>
    <textarea id="watermarkPhrases" placeholder="Enter custom invisible phrases..."></textarea>

    <button id="applyWatermark">Apply Watermark</button>

    <div class="preview">
        <h3>Watermarked HTML Preview:</h3>
        <div id="htmlPreview"></div>
    </div>

    <div class="preview">
        <h3>Watermarked BBCode Output (Forums):</h3>
        <textarea id="bbcodeOutput" readonly></textarea>
    </div>

    <script>
        const CONFIG = {
            BACKGROUND_COLOR: "#f9f9f9",
            TEXT_COLOR_BASE: "#000000",
            COLOR_VARIATION: 20,
            TEXT_COLOR_VARIATION: 40,
            PROB_SPACE_TO_INVISIBLE_CHAR: 0.1,
            PROB_NEWLINE_TO_INVISIBLE_PARA: 0.1,
            PROB_ADD_END_PARA_INVISIBLE_SENTENCE: 0.05,
            PROB_BREAK_VISIBLE_WORD: 0.2,
            MIN_WORD_LENGTH_TO_BREAK: 4,
            MICRO_INVISIBLE_CHARS: ['.', '‚', ';', ':', '·'],
            LOCALSTORAGE_KEY_CUSTOM_PHRASES: 'custom_watermark_phrases',
            DEFAULT_INVISIBLE_PARAGRAPH_CONTENT: [
                "This is an invisible watermark paragraph.",
                "Watermarking is a powerful anti-plagiarism tool."
            ]
        };

        // Load custom watermark phrases from localStorage
        const loadCustomPhrases = () => {
            const savedPhrases = localStorage.getItem(CONFIG.LOCALSTORAGE_KEY_CUSTOM_PHRASES);
            return savedPhrases ? savedPhrases.split("\n") : CONFIG.DEFAULT_INVISIBLE_PARAGRAPH_CONTENT;
        };

        const customPhrases = loadCustomPhrases();

        // Function to apply watermarking techniques
        const applyWatermark = () => {
            const inputText = document.getElementById("bbcodeInput").value;
            const watermarkPhrasesInput = document.getElementById("watermarkPhrases").value;
            const customPhrases = watermarkPhrasesInput ? watermarkPhrasesInput.split("\n") : loadCustomPhrases();

            let outputText = inputText;

            // Apply space character replacement
            outputText = outputText.replace(/ /g, (match) => {
                if (Math.random() < CONFIG.PROB_SPACE_TO_INVISIBLE_CHAR) {
                    const symbol = CONFIG.MICRO_INVISIBLE_CHARS[Math.floor(Math.random() * CONFIG.MICRO_INVISIBLE_CHARS.length)];
                    return `[color=${CONFIG.BACKGROUND_COLOR}]${symbol}[/color]`;
                }
                return match;
            });

            // Apply visible word breaking
            outputText = outputText.replace(/\b\w{4,}\b/g, (word) => {
                if (Math.random() < CONFIG.PROB_BREAK_VISIBLE_WORD) {
                    const wordFragments = word.split('').map((char, idx) => {
                        const colorVariation = Math.floor(Math.random() * CONFIG.TEXT_COLOR_VARIATION);
                        const color = `#${(parseInt(CONFIG.TEXT_COLOR_BASE.slice(1), 16) + colorVariation).toString(16)}`;
                        return `[color=${color}]${char}[/color]`;
                    });
                    return wordFragments.join('');
                }
                return word;
            });

            // Insert invisible paragraphs or sentences
            if (Math.random() < CONFIG.PROB_NEWLINE_TO_INVISIBLE_PARA) {
                const invisibleParagraph = customPhrases[Math.floor(Math.random() * customPhrases.length)];
                const invisibleFragment = invisibleParagraph.split('').map((char) => {
                    const colorVariation = Math.floor(Math.random() * CONFIG.TEXT_COLOR_VARIATION);
                    const color = `#${(parseInt(CONFIG.BACKGROUND_COLOR.slice(1), 16) + colorVariation).toString(16)}`;
                    return `[color=${color}][size=1]${char}[/size][/color]`;
                }).join('');
                outputText += `\n[size=1][color=${CONFIG.BACKGROUND_COLOR}]${invisibleFragment}[/color][/size]`;
            }

            // Preview the watermarked text
            document.getElementById("htmlPreview").innerHTML = outputText;

            // Output BBCode for phpBB
            document.getElementById("bbcodeOutput").value = outputText;
        };

        // Event listener to trigger watermarking
        document.getElementById("applyWatermark").addEventListener("click", applyWatermark);

        // Store custom watermark phrases in localStorage
        document.getElementById("watermarkPhrases").addEventListener("input", () => {
            localStorage.setItem(CONFIG.LOCALSTORAGE_KEY_CUSTOM_PHRASES, document.getElementById("watermarkPhrases").value);
        });
    </script>
</body>
</html>
